#!/bin/bash
while true; do
    # Check if the Haproxy service is running
    if systemctl is-active haproxy.service >/dev/null 2>&1; then
        # Check if the interface has the specified IP address
        if ip -br addr show dev {{ interface }} | grep -q {{ ipaddr }}; then
            echo "Haproxy service is running and interface {{ interface }} has IP address {{ ipaddr }}"
            sleep 2
        else
            echo "Interface {{ interface }} does not have IP address {{ ipaddr }}, adding it now"
            ip addr add {{ ipaddr }} dev {{ interface }}
        fi
    else
        # Haproxy service is not running, remove the IP address if it exists
        if ip -br addr show dev {{ interface }} | grep -q {{ ipaddr }}; then
            echo "Haproxy service is not running and interface {{ interface }} has IP address {{ ipaddr }}, removing it now"
            ip addr del {{ ipaddr }} dev {{ interface }}
        fi
    fi
done